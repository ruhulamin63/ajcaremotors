# Configuration Guide

This guide covers all configuration options for the AJ Care Motors platform.

## Table of Contents

- [Environment Configuration](#environment-configuration)
- [Database Configuration](#database-configuration)
- [Authentication Configuration](#authentication-configuration)
- [Mail Configuration](#mail-configuration)
- [Cache Configuration](#cache-configuration)
- [Session Configuration](#session-configuration)
- [File Storage Configuration](#file-storage-configuration)
- [Logging Configuration](#logging-configuration)
- [Queue Configuration](#queue-configuration)
- [Broadcasting Configuration](#broadcasting-configuration)
- [Security Configuration](#security-configuration)

## Environment Configuration

### Application Settings

```env
# Application basic settings
APP_NAME="AJ Care Motors"
APP_ENV=local                    # local, staging, production
APP_KEY=base64:your_key_here     # Generated by php artisan key:generate
APP_DEBUG=true                   # Set to false in production
APP_URL=http://localhost:8000    # Your application URL
APP_TIMEZONE=UTC                 # Application timezone
```

### Environment Types

#### Local Development
```env
APP_ENV=local
APP_DEBUG=true
LOG_LEVEL=debug
```

#### Staging
```env
APP_ENV=staging
APP_DEBUG=true
LOG_LEVEL=info
```

#### Production
```env
APP_ENV=production
APP_DEBUG=false
LOG_LEVEL=error
```

## Database Configuration

### MySQL Configuration
```env
DB_CONNECTION=mysql
DB_HOST=127.0.0.1
DB_PORT=3306
DB_DATABASE=ajcaremotors
DB_USERNAME=your_username
DB_PASSWORD=your_password
DB_CHARSET=utf8mb4
DB_COLLATION=utf8mb4_unicode_ci
```

### PostgreSQL Configuration
```env
DB_CONNECTION=pgsql
DB_HOST=127.0.0.1
DB_PORT=5432
DB_DATABASE=ajcaremotors
DB_USERNAME=your_username
DB_PASSWORD=your_password
```

### SQLite Configuration (for testing)
```env
DB_CONNECTION=sqlite
DB_DATABASE=/absolute/path/to/database.sqlite
```

### Advanced Database Settings

Edit `config/database.php` for advanced options:

```php
'mysql' => [
    'driver' => 'mysql',
    'url' => env('DATABASE_URL'),
    'host' => env('DB_HOST', '127.0.0.1'),
    'port' => env('DB_PORT', '3306'),
    'database' => env('DB_DATABASE', 'forge'),
    'username' => env('DB_USERNAME', 'forge'),
    'password' => env('DB_PASSWORD', ''),
    'unix_socket' => env('DB_SOCKET', ''),
    'charset' => 'utf8mb4',
    'collation' => 'utf8mb4_unicode_ci',
    'prefix' => '',
    'prefix_indexes' => true,
    'strict' => true,
    'engine' => null,
    'options' => extension_loaded('pdo_mysql') ? array_filter([
        PDO::MYSQL_ATTR_SSL_CA => env('MYSQL_ATTR_SSL_CA'),
    ]) : [],
],
```

## Authentication Configuration

### Laravel Sanctum Setup

```env
SANCTUM_STATEFUL_DOMAINS=localhost,127.0.0.1,127.0.0.1:8000,::1
```

### Authentication Configuration (`config/auth.php`)

```php
'defaults' => [
    'guard' => 'web',
    'passwords' => 'users',
],

'guards' => [
    'web' => [
        'driver' => 'session',
        'provider' => 'users',
    ],
    'api' => [
        'driver' => 'sanctum',
        'provider' => 'users',
    ],
],
```

### Password Reset Configuration

```env
# Token expiration in minutes
AUTH_PASSWORD_TIMEOUT=10800
```

## Mail Configuration

### SMTP Configuration
```env
MAIL_MAILER=smtp
MAIL_HOST=smtp.gmail.com
MAIL_PORT=587
MAIL_USERNAME=your_email@gmail.com
MAIL_PASSWORD=your_app_password
MAIL_ENCRYPTION=tls
MAIL_FROM_ADDRESS=noreply@ajcaremotors.com
MAIL_FROM_NAME="${APP_NAME}"
```

### Mailgun Configuration
```env
MAIL_MAILER=mailgun
MAILGUN_DOMAIN=your_domain.mailgun.org
MAILGUN_SECRET=your_mailgun_secret
MAILGUN_ENDPOINT=api.mailgun.net
```

### SendGrid Configuration
```env
MAIL_MAILER=sendgrid
SENDGRID_API_KEY=your_sendgrid_api_key
```

### Local Development (Mailhog)
```env
MAIL_MAILER=smtp
MAIL_HOST=127.0.0.1
MAIL_PORT=1025
MAIL_USERNAME=null
MAIL_PASSWORD=null
MAIL_ENCRYPTION=null
```

## Cache Configuration

### File Cache (Default)
```env
CACHE_DRIVER=file
```

### Redis Cache
```env
CACHE_DRIVER=redis
REDIS_HOST=127.0.0.1
REDIS_PASSWORD=null
REDIS_PORT=6379
REDIS_DB=0
```

### Memcached
```env
CACHE_DRIVER=memcached
MEMCACHED_HOST=127.0.0.1
MEMCACHED_PORT=11211
```

### Advanced Cache Configuration (`config/cache.php`)

```php
'stores' => [
    'redis' => [
        'driver' => 'redis',
        'connection' => 'cache',
        'lock_connection' => 'default',
    ],
    'memcached' => [
        'driver' => 'memcached',
        'persistent_id' => env('MEMCACHED_PERSISTENT_ID'),
        'sasl' => [
            env('MEMCACHED_USERNAME'),
            env('MEMCACHED_PASSWORD'),
        ],
        'options' => [
            // Memcached::OPT_CONNECT_TIMEOUT => 2000,
        ],
        'servers' => [
            [
                'host' => env('MEMCACHED_HOST', '127.0.0.1'),
                'port' => env('MEMCACHED_PORT', 11211),
                'weight' => 100,
            ],
        ],
    ],
],
```

## Session Configuration

### Session Settings
```env
SESSION_DRIVER=file              # file, cookie, database, redis, memcached
SESSION_LIFETIME=120             # Session lifetime in minutes
SESSION_ENCRYPT=false            # Encrypt session data
SESSION_PATH=/                   # Session cookie path
SESSION_DOMAIN=null              # Session cookie domain
```

### Database Sessions
```env
SESSION_DRIVER=database
```

Then create the sessions table:
```bash
php artisan session:table
php artisan migrate
```

## File Storage Configuration

### Local Storage (Default)
```env
FILESYSTEM_DRIVER=local
```

### Amazon S3
```env
FILESYSTEM_DRIVER=s3
AWS_ACCESS_KEY_ID=your_access_key
AWS_SECRET_ACCESS_KEY=your_secret_key
AWS_DEFAULT_REGION=us-east-1
AWS_BUCKET=your_bucket_name
AWS_USE_PATH_STYLE_ENDPOINT=false
```

### Advanced Storage Configuration (`config/filesystems.php`)

```php
'disks' => [
    'public' => [
        'driver' => 'local',
        'root' => storage_path('app/public'),
        'url' => env('APP_URL').'/storage',
        'visibility' => 'public',
    ],
    's3' => [
        'driver' => 's3',
        'key' => env('AWS_ACCESS_KEY_ID'),
        'secret' => env('AWS_SECRET_ACCESS_KEY'),
        'region' => env('AWS_DEFAULT_REGION'),
        'bucket' => env('AWS_BUCKET'),
        'url' => env('AWS_URL'),
        'endpoint' => env('AWS_ENDPOINT'),
        'use_path_style_endpoint' => env('AWS_USE_PATH_STYLE_ENDPOINT', false),
    ],
],
```

## Logging Configuration

### Log Channels
```env
LOG_CHANNEL=stack                # stack, single, daily, slack, syslog, errorlog
LOG_DEPRECATIONS_CHANNEL=null    # Channel for deprecation warnings
LOG_LEVEL=debug                  # emergency, alert, critical, error, warning, notice, info, debug
```

### Advanced Logging (`config/logging.php`)

```php
'channels' => [
    'stack' => [
        'driver' => 'stack',
        'channels' => ['single', 'slack'],
        'ignore_exceptions' => false,
    ],
    'daily' => [
        'driver' => 'daily',
        'path' => storage_path('logs/laravel.log'),
        'level' => env('LOG_LEVEL', 'debug'),
        'days' => 14,
    ],
    'slack' => [
        'driver' => 'slack',
        'url' => env('LOG_SLACK_WEBHOOK_URL'),
        'username' => 'Laravel Log',
        'emoji' => ':boom:',
        'level' => env('LOG_LEVEL', 'critical'),
    ],
],
```

## Queue Configuration

### Sync Queue (Default for local)
```env
QUEUE_CONNECTION=sync
```

### Database Queue
```env
QUEUE_CONNECTION=database
```

Create queue tables:
```bash
php artisan queue:table
php artisan migrate
```

### Redis Queue
```env
QUEUE_CONNECTION=redis
REDIS_QUEUE=default
```

### Amazon SQS
```env
QUEUE_CONNECTION=sqs
SQS_KEY=your_access_key
SQS_SECRET=your_secret_key
SQS_PREFIX=https://sqs.us-east-1.amazonaws.com/your-account-id
SQS_QUEUE=your_queue_name
SQS_REGION=us-east-1
```

## Broadcasting Configuration

### Pusher Configuration
```env
BROADCAST_DRIVER=pusher
PUSHER_APP_ID=your_app_id
PUSHER_APP_KEY=your_app_key
PUSHER_APP_SECRET=your_app_secret
PUSHER_APP_CLUSTER=mt1
```

### Redis Broadcasting
```env
BROADCAST_DRIVER=redis
```

## Security Configuration

### CORS Configuration (`config/cors.php`)

```php
return [
    'paths' => ['api/*', 'sanctum/csrf-cookie'],
    'allowed_methods' => ['*'],
    'allowed_origins' => ['*'],
    'allowed_origins_patterns' => [],
    'allowed_headers' => ['*'],
    'exposed_headers' => [],
    'max_age' => 0,
    'supports_credentials' => false,
];
```

### Trusted Proxies (`config/trustedproxy.php`)

```php
return [
    'proxies' => null,
    'headers' => Illuminate\Http\Request::HEADER_X_FORWARDED_FOR |
                 Illuminate\Http\Request::HEADER_X_FORWARDED_HOST |
                 Illuminate\Http\Request::HEADER_X_FORWARDED_PORT |
                 Illuminate\Http\Request::HEADER_X_FORWARDED_PROTO |
                 Illuminate\Http\Request::HEADER_X_FORWARDED_AWS_ELB,
];
```

### Rate Limiting
Configure in `app/Http/Kernel.php`:

```php
protected $middlewareGroups = [
    'api' => [
        'throttle:api',
        \Illuminate\Routing\Middleware\SubstituteBindings::class,
    ],
];
```

## Performance Optimization

### Production Optimization
```bash
# Cache configuration
php artisan config:cache

# Cache routes
php artisan route:cache

# Cache views
php artisan view:cache

# Optimize autoloader
composer install --optimize-autoloader --no-dev
```

### OPcache Configuration
Add to your PHP configuration:

```ini
opcache.enable=1
opcache.enable_cli=1
opcache.memory_consumption=128
opcache.interned_strings_buffer=8
opcache.max_accelerated_files=4000
opcache.revalidate_freq=2
opcache.fast_shutdown=1
```

## Monitoring and Debugging

### Debug Bar (Development)
```bash
composer require barryvdh/laravel-debugbar --dev
```

### Telescope (Development)
```bash
composer require laravel/telescope --dev
php artisan telescope:install
php artisan migrate
```

### Error Tracking (Production)
Consider integrating:
- Sentry
- Bugsnag
- Rollbar

## Environment-Specific Configurations

### Development
```env
APP_ENV=local
APP_DEBUG=true
LOG_LEVEL=debug
CACHE_DRIVER=file
SESSION_DRIVER=file
QUEUE_CONNECTION=sync
```

### Production
```env
APP_ENV=production
APP_DEBUG=false
LOG_LEVEL=error
CACHE_DRIVER=redis
SESSION_DRIVER=redis
QUEUE_CONNECTION=database
```

## Backup and Maintenance

### Backup Configuration
Consider using:
- Laravel Backup package
- Database dumps
- File storage backups

### Maintenance Mode
```bash
# Enable maintenance mode
php artisan down

# Disable maintenance mode
php artisan up

# Maintenance mode with custom message
php artisan down --message="Upgrading Database" --retry=60
```

This configuration guide should be reviewed and updated as your application grows and requirements change.
